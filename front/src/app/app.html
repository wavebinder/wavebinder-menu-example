<div class="app">

  <header class="intro">
    <h1 class="app-title">
      <div class="floating-emoji">üçΩÔ∏è</div>
      Il Menu della Serata
    </h1>
    <p class="app-subtitle">
      Seleziona la stagione, gestisci gli ospiti e scopri quali piatti sono compatibili con tutti per configurare il tuo
      gustoso men√π fisso.
    </p>
  </header>

  <div class="content-grid">

    <div class="left-column">

      <!-- SEASON -->
      <section class="section">
        <h2>Stagione</h2>
        <div class="surface">
          <ng-select
            [(ngModel)]="season"
            (ngModelChange)="updateSeason($event)">
            <ng-option value="estate">Estate</ng-option>
            <ng-option value="autunno">Autunno</ng-option>
            <ng-option value="inverno">Inverno</ng-option>
            <ng-option value="primavera">Primavera</ng-option>
          </ng-select>
        </div>
      </section>

      <!-- INGREDIENTS -->
      <section class="section">
        <h2>Ingredienti Disponibili</h2>

        <div class="ingredient-list">
          <div class="ingredient" *ngFor="let i of ingredients()">
            <div class="ingredient-main">
              <strong>{{ i.name }}</strong>
              <span class="badge">{{ i.season }}</span>
            </div>

            <div class="ingredient-meta">
              <span>Qty: {{ i.quantity }}</span>
              <span>{{ i.tags }}</span>
            </div>
          </div>
        </div>
      </section>
    </div>


    <div class="right-column">

      <!-- GUESTS -->
      <section class="section">
        <h2>Ospiti</h2>

        <div class="guest-grid">
          <div class="guest-card" *ngFor="let g of guests()" [class.over-budget]="isOverBudget(g)">
            <label class="guest-header">
              <input type="checkbox" checked (change)="toggleGuest(g, $event.target)">
              <strong>{{ g.name }}</strong>
            </label>

            <div class="guest-body">
              <div><b>Diet</b>: {{ g.diet }}</div>
              <div><b>Allergies</b>: {{ g.allergies }}</div>
              <div><b>Dislikes</b>: {{ g.dislikes }}</div>
              <div><b>Budget</b>: {{ g.budget }} ‚Ç¨</div>
            </div>
          </div>

          <div class="guest-card inactive" *ngFor="let g of uninvited">
            <label class="guest-header">
              <input type="checkbox" (change)="toggleGuest(g, $event.target)">
              <strong>{{ g.name }}</strong>
            </label>

            <div class="guest-body">
              <div><b>Diet</b>: {{ g.diet }}</div>
              <div><b>Allergies</b>: {{ g.allergies }}</div>
              <div><b>Dislikes</b>: {{ g.dislikes }}</div>
              <div><b>Budget</b>: {{ g.budget }} ‚Ç¨</div>
            </div>
          </div>
        </div>
      </section>

      <!-- RESULT -->
      <section class="section result result-section" *ngIf="ingredients()">
        <h2 class="analysis-title">Piatti Compatibili</h2>

        <div class="result-list">
          <div class="result-item" *ngFor="let d of dishes()">
            <input type="checkbox" (change)="toggleSelectedDish(d, $event.target)">
            <strong>{{ d.name }}</strong>
            <span class="pill">{{ d.cost }} ‚Ç¨</span>
          </div>
        </div>
      </section>

      <!-- ANALYSIS SUMMARY -->
      <section class="section" *ngIf="analysis()">
        <div class="analysis-card analysis-under-result">

          <h2 class="analysis-title">Analisi del Pasto</h2>

          <div class="analysis-metrics">
            <div class="metric">
              <span class="label">Costo totale</span>
              <span class="value">{{ analysis().cost_total }} ‚Ç¨</span>
            </div>

            <div class="metric">
              <span class="label">Peso totale</span>
              <span class="value">{{ analysis().weight_total_g }} g</span>
            </div>

            <div class="metric">
              <span class="label">Calorie</span>
              <span class="value">{{ analysis().calories_total_kcal }} kcal</span>
            </div>
          </div>

          <div class="analysis-macros">
            <h3>Macronutrienti</h3>

            <div class="macro-bar">
              <div class="macro-label">Proteine</div>
              <div class="bar-track">
                <div
                  class="bar protein"
                  [style.width.%]="analysis().macros_percentage.protein"
                ></div>
              </div>
              <div class="macro-value">
                {{ analysis().macros_g.protein }} g
                ({{ analysis().macros_percentage.protein }}%)
              </div>
            </div>

            <div class="macro-bar">
              <div class="macro-label">Carboidrati</div>
              <div class="bar-track">
                <div
                  class="bar carbs"
                  [style.width.%]="analysis().macros_percentage.carbs"
                ></div>
              </div>
              <div class="macro-value">
                {{ analysis().macros_g.carbs }} g
                ({{ analysis().macros_percentage.carbs }}%)
              </div>
            </div>

            <div class="macro-bar">
              <div class="macro-label">Grassi</div>
              <div class="bar-track">
                <div
                  class="bar fat"
                  [style.width.%]="analysis().macros_percentage.fat"
                ></div>
              </div>
              <div class="macro-value">
                {{ analysis().macros_g.fat }} g
                ({{ analysis().macros_percentage.fat }}%)
              </div>
            </div>
          </div>

        </div>
      </section>

    </div>

  </div>
</div>
